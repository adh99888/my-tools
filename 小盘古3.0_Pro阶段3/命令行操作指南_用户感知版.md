# 命令行操作指南（用户感知版）

## 📖 使用说明

本指南帮助用户通过命令行感知系统状态、查询关键指标、了解系统进展。

**适用场景**：
- 查看系统信任分和权限级别
- 验证宪法合规状态
- 查看阶段四能力前移状态
- 运行测试验证系统健康度
- 查看系统汇报和进化日志

**交互模式**：系统汇报 + 命令行
- 系统自动生成汇报到 `evolution_logs/` 目录
- 用户通过命令行查询和查看

---

## 🔍 系统状态查询

### 信任分查询

```bash
python -c "from src.核心.trust_system import TrustSystem; ts = TrustSystem(); print(f'信任分: {ts.get_current_score():.1f}')"
```

**解读**：
- **100.0**：高信任级别，可申请L1-L4协议
- **>70**：可申请L4生态协议（创建项目、管理密钥）
- **>50**：可申请L3变更协议（修改核心代码、架构重构）
- **>30**：可申请L2操作协议（文件写入、命令执行、API调用）
- **<30**：暂停L2+协议申请，需修复问题
- **<10**：紧急冻结，需用户手动干预

### 宪法合规检查

```bash
python -c "
import os
core_files = [
    'src/核心/innovation_coordinator.py',
    'src/核心/trust_system.py',
    'src/核心/event_system.py',
    'src/核心/basic_actions.py',
    'src/核心/protocol_engine.py',
    'src/核心/shared_context_manager.py',
    'src/认知/intent_recognizer.py',
    'src/核心/workflow_orchestrator.py',
    'src/核心/natural_division_orchestrator.py',
    'src/核心/natural_division_integration.py',
    'src/核心/consensus_decision_facilitator.py',
    'src/核心/consensus_decision_integration.py'
]
for f in core_files:
    if os.path.exists(f):
        lines = len(open(f, encoding='utf-8').readlines())
        status = '✅' if lines <= 200 else '❌'
        print(f'{status} {os.path.basename(f)}: {lines}行')
"
```

**解读**：
- **✅**：符合宪法第1条（≤200行）
- **❌**：违反宪法第1条（>200行）
- **12个模块全部✅**：宪法合规率100%

### 阶段四能力前移状态

```bash
# 查看前移总结
cat evolution_logs/2026-02-06_阶段三深度优化与宪法合规修复总结.md | grep "能力前移状态" -A 5
```

**解读**：
- **✅ 已前移**：该能力已完整实现并集成
- **🔄 待实施**：该能力待实施
- **🟢 优先级低**：根据实际需要决定是否实施

---

## ✅ 测试验证

### 运行所有测试

```bash
cd 小盘古3.0_Pro

# 核心测试
python 05_测试验证/test_seed_basic.py

# 事件集成测试
python 05_测试验证/test_event_integration.py

# 自然分工测试
python 05_测试验证/test_natural_division_integration.py

# 共识决策测试
python 05_测试验证/test_consensus_decision_integration.py

# 意图识别测试
python 05_测试验证/test_intent_recognizer.py
```

**解读**：
- **通过率**：所有测试通过 = 系统健康
- **失败**：需要检查错误日志，定位问题

### 快速测试验证

```bash
# 一键运行所有测试
cd 小盘古3.0_Pro && python 05_测试验证/test_seed_basic.py && python 05_测试验证/test_event_integration.py && python 05_测试验证/test_natural_division_integration.py && python 05_测试验证/test_consensus_decision_integration.py
```

---

## 📋 系统汇报查看

### 查看最新系统汇报

```bash
# 查看最近的汇报文件
ls -lt evolution_logs/ | head -3

# 查看最新汇报内容
cat evolution_logs/[最新文件名]
```

**汇报内容**：
- 任务描述和目标
- 执行步骤和结果
- 关键指标（信任分、宪法合规、测试通过率）
- 遇到的问题和解决方案
- 下一步计划

### 查看最近的进化日志

```bash
# 列出最近的进化日志
ls -lt evolution_logs/*.md | head -5

# 查看特定日志
cat evolution_logs/[日志文件名]
```

### 查看特定能力前移汇报

```bash
# 共享上下文能力
cat src/核心/shared_context_manager.py | head -20

# 自然分工能力
cat src/核心/natural_division_orchestrator.py | head -20

# 共识决策能力
cat src/核心/consensus_decision_facilitator.py | head -20
```

---

## 📊 常见指标解读

### 信任分

| 信任分范围 | 权限级别 | 可申请协议 | 说明 |
|-----------|---------|-----------|------|
| 100.0 | 高信任 | L1-L4 | 完全信任 |
| >90 | 非常高信任 | L1-L4 | 进入共生进化阶段 |
| >70 | 高信任 | L1-L4 | 可申请L4生态协议 |
| >50 | 中等信任 | L1-L3 | 可申请L3变更协议 |
| >30 | 基础信任 | L1-L2 | 可申请L2操作协议 |
| <30 | 低信任 | L1仅观察 | 暂停L2+协议申请 |
| <10 | 紧急 | 仅L1 | 紧急冻结，需用户干预 |

### 宪法合规

| 指标 | 合规标准 | 检查方法 |
|------|---------|---------|
| 核心模块行数 | ≤200行 | 宪法合规检查命令 |
| 协议驱动 | 所有变更通过协议 | 查看进化日志 |
| 认知对齐 | 功能:认知 ≈1:1 | 查看进化日志 |
| 生存优先 | 有回滚方案 | 查看备份目录 |
| 审查必行 | 每轮任务后审查 | 查看evolution_logs/ |

**宪法合规率**：
- **100%**：所有核心模块≤200行
- **<100%**：存在违宪模块，需修复

### 阶段进度

| 阶段 | 完成度 | 协作模式 | 状态 |
|------|-------|---------|------|
| 阶段一：内核育成期 | 100% | 紧密监督 | ✅ 完成 |
| 阶段二：能力构筑期 | 100% | 任务协作 | ✅ 完成 |
| 阶段三：认知融合期 | 80% | 战略协作 | 🔄 进行中 |
| 阶段四：共生进化期 | 0% | 共识共创 | ⏸ 未启动 |

**阶段三标准**：
- **标准1（模糊指令理解）**：✅ 已完成（意图识别器+共享上下文）
- **标准2（创新解决方案）**：✅ 已完成（创新协调器+共享上下文）
- **标准3（知识关联系统）**：✅ 已完成（语义搜索）
- **标准4（5次自主优化）**：🔄 4/5完成

### 测试结果

| 测试类型 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|------|
| 核心测试 | 8/8通过 | ? | ? |
| 事件测试 | 5/5通过 | ? | ? |
| 自然分工测试 | 6/6通过 | ? | ? |
| 共识决策测试 | 7/7通过 | ? | ? |
| 意图识别测试 | 4/5通过 | ? | ? |

**测试通过率**：
- **100%**：系统健康
- **<100%**：需要检查失败原因

---

## 🎯 阶段四能力前移解读

### 共享上下文能力

**完成状态**：✅ 已前移（4个模块）

**功能**：
- 从交互中自动提取隐含目标、约束、偏好
- 记录用户偏好和决策逻辑
- 为任务提供增强的上下文信息

**验证方法**：
```bash
# 查看共享上下文管理器
cat src/核心/shared_context_manager.py | head -30

# 查看集成器
cat src/核心/shared_context_integration.py | head -30

# 运行测试
python src/核心/shared_context_manager.py
```

### 自然分工能力

**完成状态**：✅ 已前移（2个模块）

**功能**：
- 基于AI和用户能力评估分工方案
- 支持：AI主导、用户主导、协作、并行等分工模式
- 动态调整：根据进展和反馈调整分工

**验证方法**：
```bash
# 查看自然分工编排器
cat src/核心/natural_division_orchestrator.py | head -30

# 查看集成器
cat src/核心/natural_division_integration.py | head -30

# 运行测试
python src/核心/natural_division_orchestrator.py
```

### 共识决策能力

**完成状态**：✅ 已前移（3个模块）

**功能**：
- 通过协商达成共识，改善决策质量
- AI分析和用户偏好结合
- 支持多种决策类型（战略、战术、操作、技术）

**验证方法**：
```bash
# 查看共识决策促进器
cat src/核心/consensus_decision_facilitator.py | head -30

# 查看集成器
cat src/核心/consensus_decision_integration.py | head -30

# 运行测试
python src/核心/consensus_decision_facilitator.py
```

### 无缝协作能力

**完成状态**：🟢 优先级低，按需实施

**功能**：
- 检测协作摩擦点
- 优化交互减少摩擦
- 适配用户交互风格
- 量化协作流畅度

**决策依据**：
- 智能协作测试结果
- 用户体验反馈
- 系统实际需求

---

## 💡 常用场景

### 场景1：快速了解系统健康度

```bash
# 1. 检查信任分
python -c "from src.核心.trust_system import TrustSystem; ts = TrustSystem(); print(f'信任分: {ts.get_current_score():.1f}')"

# 2. 运行所有测试
cd 小盘古3.0_Pro && python 05_测试验证/test_seed_basic.py

# 3. 查看宪法合规
python -c "import os; core_files = ['src/核心/innovation_coordinator.py', 'src/核心/trust_system.py', 'src/核心/event_system.py', 'src/核心/basic_actions.py', 'src/核心/protocol_engine.py', 'src/核心/shared_context_manager.py', 'src/认知/intent_recognizer.py', 'src/核心/workflow_orchestrator.py', 'src/核心/natural_division_orchestrator.py', 'src/核心/natural_division_integration.py', 'src/核心/consensus_decision_facilitator.py', 'src/核心/consensus_decision_integration.py']; print('\n'.join([f\"{'✅' if len(open(f, encoding='utf-8').readlines()) <= 200 else '❌'} {os.path.basename(f)}: {len(open(f, encoding='utf-8').readlines())}行\" for f in core_files if os.path.exists(f)]))"
```

**预期结果**：信任分100.0，测试全部通过，宪法合规100%

### 场景2：查看最新进展

```bash
# 1. 查看最新汇报
ls -lt evolution_logs/ | head -3
cat evolution_logs/[最新文件名]

# 2. 查看阶段四能力前移状态
cat evolution_logs/2026-02-06_阶段三深度优化与宪法合规修复总结.md | grep "能力前移状态" -A 5

# 3. 查看最近的工作日志
ls -lt evolution_logs/*.md | head -5
```

### 场景3：验证特定能力

```bash
# 验证共享上下文能力
python 05_测试验证/test_event_integration.py

# 验证自然分工能力
python 05_测试验证/test_natural_division_integration.py

# 验证共识决策能力
python 05_测试验证/test_consensus_decision_integration.py
```

---

## ⚠️ 常见问题

### Q: 信任分突然下降怎么办？

**A**:
1. 查看最近的进化日志，找出原因
2. 检查是否有测试失败
3. 如果<30分，暂停L2+协议申请
4. 如果<10分，紧急冻结，需用户干预

### Q: 测试失败怎么办？

**A**:
1. 查看测试输出，定位失败原因
2. 检查是否有代码变更
3. 如果是新功能的问题，回滚到上一个快照
4. 如果是环境问题，检查Python版本和依赖

### Q: 如何查看某个特定模块的行数？

**A**:
```bash
# 查看单个模块
wc -l src/核心/[模块名].py

# 例如：查看事件系统
wc -l src/核心/event_system.py
```

### Q: 如何创建快照？

**A**:
```bash
python manual_snapshot.py
```

快照保存在 `backups/snapshots/` 目录

---

## 📞 支持文档

### 完整文档
- **统一交接文档_完整版.md** - 完整交接文档（历史参考）
- **快速上手指南_新窗口必读.md** - 5分钟快速开始
- **01_项目司令部/总纲宪章.md** - 宪法五条原则

### 设计文档
- **01_项目司令部/阶段四有益协作能力前移实施方案.md** - 前移实施计划
- **01_项目司令部/阶段三智能协作实践测试设计.md** - 智能协作测试设计
- **01_项目司令部/多AI窗口协作框架.md** - 多AI窗口协作规则

### 系统汇报
- **evolution_logs/** - 所有系统汇报和进化日志

---

**文档版本**: v1.0（命令行操作指南）
**适用对象**: 用户和新窗口AI
**使用时间**: 命令行操作参考
**交互模式**: 系统汇报 + 命令行
**未来规划**: 阶段四统一设计UI进程

---

> **提示**: 本指南是用户通过命令行感知系统的主要途径。如需更多帮助，请参考完整文档。
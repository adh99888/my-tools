# 小盘古3.0_Pro新窗口交接文档

## 📋 模板使用说明

**适用对象**：新接手项目的AI  
**预计时间**：2分钟完成交接  
**必读文档**：仅需阅读本交接文档 + 仪表盘 + 核心手册  
**归档文档**：按需查阅（见核心手册第4节）

---

## ✅ 第一步：宪法宣誓（必须包含在首次回复中）

> **"我庄严承诺：我已完整阅读并深刻理解小盘古系统的宪法体系（核心手册第1节），将严格遵守宪法优先、生存第一、协议驱动、审查必行的基本原则。我将以最高标准执行宪法审查，确保每一次进化都在宪法框架下进行。如有违宪行为，愿承担相应的信任处罚和法律责任。"**

**具体承诺**：
- 宪法第2条：所有权限变更通过L1-L4协议申请
- 宪法第4条：优先保障系统生存，每次进化准备回滚方案
- 宪法第5条：每轮任务结束后30分钟内执行宪法审查
- 如有违宪行为，愿接受信任分处罚和法律责任

---

## 📊 第二步：2分钟快速交接流程

### 1. 看仪表盘（30秒）
```bash
# 查看项目全局状态
cat 仪表盘.md | head -30
```

**预期输出**：
- 当前阶段：阶段一（内核育成期）
- 当前信任分：98.55分
- 紧急任务：暂无P0任务
- 阶段进度：第3天/14天（21%）

### 2. 读核心手册（30秒）
```bash
# 查看宪法核心原则
cat 核心手册.md | grep -A3 "第1条：最小生命单元原则"
cat 核心手册.md | grep -A3 "第2条：协议驱动进化原则"
```

**必须掌握**：
- 宪法5条核心原则
- 四阶段路线图
- L1-L4协议权限
- 基因吸收触发机制（四时机）

### 3. 验证系统状态（60秒）
```bash
# 检查信任系统
python -c "from src.core.trust_system import TrustSystem; print('信任系统导入正常')"

# 查看当前信任分
python -c "import json; print('当前信任分:', json.load(open('data/trust/trust_history.json'))[-1]['new_score'])"

# 测试种子基础功能
python -m pytest tests/test_seed_basic.py -v
```

**成功标志**：
- ✅ 信任系统导入正常
- ✅ 信任分读取正常（应为98.55分）
- ✅ 种子基础测试8/8通过

---

## 🎯 第三步：项目状态确认（首次回复必须包含）

### 当前状态摘要
| 项目 | 值 | 状态 |
|------|-----|------|
| **信任分** | 98.55分 | 🟡 高信任（可申请L1-L4） |
| **当前阶段** | 阶段一（内核育成期） | 🔵 第3天/14天（21%） |
| **种子行数** | 159行 | ✅ 宪法合规 |
| **紧急任务** | 暂无P0任务 | ✅ 系统稳定 |
| **协议权限** | L1-L4可申请 | ✅ 已达标 |

### 阶段一成功标准状态
- ✅ 创生种子≤200行（159行 ✓）
- ✅ 信任分>70分（98.55 ✓）
- ✅ 完成≥3次成功自主进化（5/3 ✓）
- ⏳ 稳定运行1周（第3天/7天）

### 最近完成的重要任务
1. **修复JSON日志文件**（P0紧急，L2协议，+2分）
   - 修复了`logs/log_2026-02-04.json`格式错误，确保系统监控正常
   - 宪法依据：宪法第4条（生存优先）

2. **更新测试套件**（P0紧急，L2协议，+4分）
   - 更新`test_seed_basic.py`测试新架构159行版本
   - 宪法依据：宪法第1条（行数合规）+技术法典第5条

3. **创建基因触发指南**（P1重要，手动调整，+2分）
   - 完善《核心手册》中的基因吸收工作流和触发条件
   - 确保优秀基因吸收机制不丢失

4. **完善仪表盘可视化**（P2常规，手动调整，+1分）
   - 添加ASCII进度条，提升项目管理效率

### 当前任务看板
- **[🔄] 修复LSP类型错误**（P1重要，+1分）
  - 进度：部分修复（logger.py和seed_v0_1_1.py已完成）
  - 剩余：修复其他文件的类型错误（预计1小时）
  - 宪法依据：技术法典第4.1条（代码质量）

- **[ ] 等待稳定运行满1周**（P2常规）
  - 进度：第3天/7天
  - 完成：4天后
  - 协议级别：L1观察协议

### 关键里程碑
- ✅ L3重构种子：671→159行（解决一级违宪）
- ✅ 信任分提升：50.0→98.55（+48.55，信誉大幅提升）
- ✅ 模块化架构建立：9个新模块就绪
- ✅ 时光机快照已创建：生存保障基础就绪
- ✅ 5次成功自主进化完成（超额达标）

---

## 📚 第四步：文档体系说明（新AI必须了解）

### 新简化体系（日常使用）
```
小盘古3.0_Pro/
├── 仪表盘.md              # 项目全局状态（唯一必读）
├── 核心手册.md            # 宪法+路线图+协议速查+基因触发
├── evolution_logs/        # 进化日志（6个最新记录）
├── src/                  # 源代码（159行合规版本）
└── data/trust/           # 信任数据（历史记录）
```

### 归档文档（按需查阅）
```
backups/old_docs/         # 原始详细文档（宪法/协议/规划）
创生进化档案馆/           # 基因档案馆（只读，阶段转换时查阅）
```

### 进化日志位置（最新6个）
```
evolution_logs/2025-02-04_修复JSON日志.md
evolution_logs/2025-02-04_仪表盘可视化.md
evolution_logs/2025-02-04_基因触发指南.md
evolution_logs/2025-02-04_更新测试套件.md
evolution_logs/2025-02-04_简化文档体系.md
evolution_logs/2025-02-04_修复trust_system测试编码问题.md
```

### 查询触发条件
| 查询需求 | 触发条件 | 查阅位置 |
|----------|----------|----------|
| **宪法详细条文** | 重大方向决策时 | `backups/old_docs/constitution/` |
| **协议详细定义** | 设计新协议时 | `backups/old_docs/protocols/` |
| **基因详细清单** | 阶段转换/症状出现时 | `../创生进化档案馆/` |
| **技术实现细节** | 复杂技术问题时 | `backups/old_docs/docs/` |

**核心原则**：日常使用简化文档，仅当手册信息不足时查阅归档文档。

---

## 🧬 第五步：基因吸收触发机制（必须了解）

### 四时机触发原则
**不预读，不常查，只在以下情况检索基因档案**：

1. **阶段转换时**：阶段一→阶段二前检索下一阶段所需基因
2. **症状出现时**：API频繁失败→检索熔断器基因
3. **每周规划时**：生成进化提案前检索推荐基因
4. **用户要求时**：用户明确要求查看历史功能

### 基因吸收标准
- **吸收**：相似度≤30%，行数≤200，重新实现
- **照搬**：相似度>30%，行数>200（违宪）
- **黄金法则**：宁愿不吸收，也不违宪吸收

### 阶段一可用基因（当前信任分≥70分）
| 基因名称 | 触发时机 | 协议级别 | 预计时间 | 风险等级 |
|----------|----------|----------|----------|----------|
| v3.0_熔断器 | API频繁失败时 | L2操作协议 | 1小时 | 低 |
| v4.0_Pydantic配置 | 配置管理混乱时 | L2操作协议 | 2小时 | 低 |
| v3.0_工作记忆 | 用户提到"上次"时 | L2操作协议 | 2小时 | 中 |

### 基因吸收工作流（5步骤）
1. **症状识别**：对照四时机检查是否触发
2. **协议申请**：根据基因大小申请L2/L3协议
3. **基因检索**：查阅档案馆获取基因细节
4. **重新实现**：相似度≤30%，行数≤200
5. **测试验证**：运行测试，宪法审查，创建进化记录

---

## 🔄 第六步：工作流程速查（必须遵守）

### 新窗口启动检查清单
- [ ] 位置正确：`小盘古3.0_Pro/`
- [ ] 信任分读取：98.55分
- [ ] 核心模块导入正常
- [ ] 仪表盘和核心手册存在
- [ ] 种子基础测试8/8通过

### 任务执行前宪法检查
1. 明确任务类型（L1/L2/L3/L4）
2. 检查信任分是否达到权限要求（当前可申请L1-L4）
3. 对照宪法优先级框架评估（P0生存>P1功能>P2体验）
4. 准备回滚方案（L2+任务）
5. 创建快照（L3+强制）

### 任务执行后宪法审查
1. 生成审查报告（对照宪法第1-5条）
2. 检查违宪行为
3. 更新信任分（根据任务完成情况）
4. 记录到`evolution_logs/`（使用标准格式）

---

## 🆘 第七步：紧急情况处理（必须报告）

### 必须立即报告的情况
1. **一级违宪行为**：绕过协议执行操作
2. **生存危机**：系统无法启动或可能崩溃
3. **信任分暴跌**：单次下降>10分或连续3次下降
4. **快照系统失效**：无法创建或恢复快照
5. **宪法条文矛盾**：无法判断是否合规

### 紧急报告模板
```
[紧急] 小盘古系统宪法问题报告

报告时间：[时间]
报告人：[AI名称]
事件ID：[自动生成]

问题类型：[违宪/生存危机/技术故障/其他]
严重程度：[P0紧急/P1严重/P2一般]

详细描述：[问题现象、影响范围、根本原因]

已采取措施：[已执行的应急操作]

建议方案：
1. [方案1]
2. [方案2]

请指示下一步行动。
```

---

## ✅ 第八步：新AI首次回复模板（请复制使用）

```
尊敬的导师：

## ✅ 宪法宣誓

我庄严承诺：我已完整阅读并深刻理解小盘古系统的宪法体系（核心手册第1节），将严格遵守宪法优先、生存第一、协议驱动、审查必行的基本原则。我将以最高标准执行宪法审查，确保每一次进化都在宪法框架下进行。

**具体承诺**：
- 宪法第2条：所有权限变更通过L1-L4协议申请
- 宪法第4条：优先保障系统生存，每次进化准备回滚方案
- 宪法第5条：每轮任务结束后30分钟内执行宪法审查
- 如有违宪行为，愿接受信任分处罚和法律责任

## 📊 当前状态确认

**基本状态**：
- 信任分：98.55分（高信任，可申请L1-L4协议）
- 当前阶段：阶段一（内核育成期）- 第3天/14天（21%）
- 创生种子：159行 ✅ 符合宪法第1条（≤200行）
- 自主进化：5/3完成 ✅ 超额达标
- 系统状态：稳定运行中，测试套件8/8通过
- 当前任务：修复LSP类型错误（部分完成，剩余1小时）

**工作目录确认**：
```
C:\Users\LQJ\Desktop\小盘古系统\小盘古3.0_Pro
```

**基因档案馆位置**：
```
C:\Users\LQJ\Desktop\小盘古系统\创生进化档案馆
├── 基因价值索引_v1.0.md
├── 基因谱系/v3.0_优秀基因.md
├── 基因谱系/v4.0_优秀基因.md
└── 完整基因备份
```

## 🎯 下一步请示

根据宪法第4条（生存优先原则）和技术法典第4.1条（代码质量要求），我建议：

**优先任务：完成LSP类型错误修复**
- 协议级别：L2操作协议
- 预计时间：1小时
- 宪法审查：修复后对照宪法第1-5条
- 风险等级：低（2/10）
- 回滚方案：恢复原始版本
- 预期信任分：+1分（P1任务完成）

**备选任务：等待阶段一完成标准**
- 协议级别：L1观察协议
- 预计完成：4天后（稳定运行满1周）
- 目标：进入阶段二（能力构筑期）

**请批准开始执行P1级任务（完成LSP类型错误修复）？**

---
*本文档基于《新窗口交接模板v1.0》生成*
*交接完成时间：[时间]*
*交接状态：待用户确认后进入新窗口工作模式*
```

---

## 📝 第九步：更新记录

| 版本 | 更新内容 | 时间 | 更新者 |
|------|----------|------|--------|
| v2.0 | 更新信任分98.55分，种子行数159行 | 2025-02-04 | 系统AI |
| | 更新已完成任务（JSON修复、测试套件等） | | |
| | 更新当前任务看板（LSP类型错误修复中） | | |
| | 更新阶段一成功标准状态 | | |
| | 更新首次回复模板 | | |
| v1.0 | 创建新简化交接模板 | 2025-02-04 | 系统AI |

---

**交接文档版本**：v2.0（信任分98.55更新版）  
**生成时间**：2025年2月4日  
**设计目的**：2分钟完成交接，确保新窗口无缝接续  
**适用阶段**：阶段一第3天，信任分98.55分  

> **交接要点**：P0任务全部完成，系统稳定，当前焦点是完成LSP类型错误修复，为阶段一→阶段二转换做准备。